<!DOCTYPE html><html><head><title>SMS and MMS Marketing Notifications</title><style>body, html {
  height:100%;
  width:100%;
  padding:0;
  margin:0;
  overflow:hidden;
  background-color:#ddd;
}
.wrapper {
  height:100%;
  width:100%;
}</style><link rel="shortcut icon" href="//twilio.com/bundles/marketing/img/favicons/favicon.ico"><link rel="apple-touch-icon" href="//twilio.com/bundles/marketing/img/favicons/favicon_57.png"><link rel="apple-touch-icon" sizes="72x72" href="//twilio.com/bundles/marketing/img/favicons/favicon_72.png"><link rel="apple-touch-icon" sizes="114x114" href="//twilio.com/bundles/marketing/img/favicons/favicon_114.png"><link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css"><link rel="stylesheet" href="viewsaurus.css"></head><body><div class="wrapper"><div id="viewsaurus" data-title="SMS and MMS Marketing Notifications"><div class="saurus-panes"><div class="saurus-prose"><div class="saurus-prose-header"><div class="title-outer"><span class="step-title">SMS and MMS Marketing Notifications</span></div></div><div class="saurus-nav-buttons"><div class="saurus-nav-button nav-overview"><div class="saurus-nav-button-inner"><i class="fa fa-fw fa-list"></i></div><div class="nav-divider"></div></div><div class="saurus-nav-button nav-previous"><div class="saurus-nav-button-inner"><a href=""> <i class="fa fa-fw fa-play fa-rotate-180"></i></a></div><div class="nav-divider"></div></div><div class="saurus-nav-button nav-next clickable"><div class="saurus-nav-button-inner"><a href="#1"> <i class="fa fa-fw fa-play"></i></a></div></div><div class="saurus-next-title"><span class="next-title-inner"></span></div></div><div class="saurus-progress-bar"></div><div class="saurus-start"><p>SMS and MMS messages are a personal way to engage with users, offering a much higher open rate than e-mail and more impact than a tweet. Learn how to engage customers in a mobile marketing campaign using SMS and MMS messages.</p><a href="#0">Start Tutorial</a></div><div class="saurus-content"><div data-title="Subscribing for Notifications" class="chapter"><div data-title="Introduction" class="step"><h2 id="sms-and-mms-marketing-notifications">SMS and MMS Marketing Notifications</h2>
<p>Ready to implement SMS and MMS marketing notifications? Here&#39;s how it works at a high level:</p>
<ol>
<li>A user you&#39;d like to reach sends an SMS text message to a Twilio phone number you advertise in print, online, or in TV advertising</li>
<li>Your application confirms that the user wants to receive SMS and MMS notifications from your application</li>
<li>An adminsitrator or marketing campaign manager uses a web form to craft a message that will go out to all subscribers via SMS/MMS message</li>
</ol>
<h2 id="building-blocks">Building Blocks</h2>
<p>To get this done, you&#39;ll be working with the following Twilio APIs:</p>
<ul>
<li><a href="http://www.local.twilio.com/docs/api/twiml">TwiML</a> and the <a href="/docs/api/twiml/sms/message">&lt;Message&gt; Verb</a>: We&#39;ll use TwiML to manage interactions initiated by the user via SMS</li>
<li><a href="/docs/api/rest/sending-sms">Messages Resource</a>: We will use the REST API to broadcast messages out to all subscribers</li>
</ul>
<h2 id="how-to-read-this-tutorial">How To Read This Tutorial</h2>
<p>In this tutorial, we will be working through a series of <a href="http://en.wikipedia.org/wiki/User_story">user stories</a> that describe how to fully implement this Twilio-powered application. Each will describe a major step on the road to implementing this functionality yourself.
Let&#39;s get started! Click the right arrow to move on to the next step of the tutorial.</p>
</div><div data-title="User Story: Subscribe for Updates" data-file="MarketingNotifications/Models/Subscriber.cs" data-highlight="" class="step"><h2>User Story: Subscribe for Updates</h2><blockquote>As a User, I would like to sign up via SMS to receive SMS or MMS updates on my phone.</blockquote><p>In order to send out marketing notifications to a user, we need to provide a way for them to opt in to receive updates. We accomplish this by having them send a text message to a Twilio number in our account, and then save their phone number in our database.</p>
<p>To make this happen, we will need to implement a couple of things:</p>
<ul>
<li>a model object to save information about a <code>Subscriber</code></li>
<li>an <a href="http://www.asp.net/mvc">ASP.NET MVC 5</a> web application that can respond to <a href="/docs/api/twiml/sms/twilio_request">Twilio webhook requests</a> when our number gets an incoming text.</li>
</ul>
<p>Let&#39;s start by looking at the model for a <code>Subscriber</code>.</p>
</div><div data-title="Creating a Subscriber" data-file="MarketingNotifications/Models/Subscriber.cs" data-highlight="12-16" class="step"><h2 id="creating-a-subscriber">Creating a Subscriber</h2>
<p>We begin by adding an <a href="https://msdn.microsoft.com/en-us/data/ee712907#codefirst">Entity Framework Code First</a> model that will help us store information about a subscriber in a SQL Server database.</p>
<p>For our purposes we don&#39;t need to store very much information about the subscriber - just their phone number (so we can send them updates) and a boolean flag indicating whether or not they are opted-in to receive updates.</p>
<p>Now that we have a model object to save a subscriber, let&#39;s move up to the controller level to see how we create one.</p>
</div><div data-title="Creating a Webhook Route" data-file="MarketingNotifications/App_Start/RouteConfig.cs" data-highlight="16-20" class="step"><h2 id="creating-a-webhook-route">Creating a Webhook Route</h2>
<p>In an ASP.NET MVC application, we create controllers to handle incoming HTTP requests. When Twilio receives an incoming message, it will send an HTTP POST request to our server.</p>
<p>We will create a <code>NotificationsController</code> that will handle all of the incoming traffic for our application. In our <code>RouteConfig</code> we specify that the route <code>/message</code> will map to our <code>NotificationsController</code>&#39;s <code>/Incoming</code> action method.</p>
</div><div data-title="Mapping the Webhook to a Route" data-file="MarketingNotifications/App_Start/RouteConfig.cs" data-highlight="16-20" class="step"><h2 id="mapping-the-webhook-to-a-route">Mapping the Webhook to a Route</h2>
<p>Click on one of your Twilio numbers on the <a href="/user/account/phone-numbers/incoming">Manage Phone Numbers</a> screen in the account portal. For this number, you will need to configure a public server address for your application, as well as the <code>/message</code> route which Twilio will POST to when your number gets any incoming messages:</p>
<p><img src="//s3.amazonaws.com/howtodocs/marketing-notifications-webhook.png" alt="Twilio Number Configuration"></p>
<p>Let&#39;s dive into the controller function that will handle incoming messages next.</p>
</div><div data-title="Handling An Incoming Message" data-file="MarketingNotifications/Controllers/NotificationsController.cs" data-highlight="56-80" class="step"><h2 id="handling-an-incoming-message">Handling An Incoming Message</h2>
<p>Since the <code>/Incoming</code> action method will be called every time our application receives a message, it has a lot it needs to do. We&#39;ll look at how this function works piece by piece as the tutorial continues, but let&#39;s focus on the first message a user sends us for now.</p>
</div><div data-title="Creating a New Subscriber" data-file="MarketingNotifications/Controllers/NotificationsController.cs" data-highlight="56-68" class="step"><h2 id="creating-a-new-subscriber">Creating a New Subscriber</h2>
<p>We begin by getting the texter&#39;s phone number from the <a href="/docs/api/twiml/sms/twilio_request">incoming Twilio request</a>. Now, we need to find a <code>Subscriber</code> model with that phone number (this should be a unique property of the <code>Subscriber</code>).</p>
<p>If there&#39;s no subscriber with this phone number, we create one, save it, and respond with a message asking them to text &quot;subscribe&quot; to confirm that they want to receive messages from us.</p>
<p>And that&#39;s all we want at this step! We&#39;ve created a <code>Subscriber</code> model to keep track of the people that want our messages, and saved them in the database when they text us for the first time.</p>
<p>Next, let&#39;s look at the logic we need to put in place to allow them to manage their subscription status.</p>
</div></div><div data-title="Managing Subscriptions" class="chapter"><div data-title="User Story: Manage Subscriptions" data-file="MarketingNotifications/Controllers/NotificationsController.cs" class="step"><h2>User Story: Manage Subscriptions</h2><blockquote>As a User, I would like to manage my subscription status via text message.</blockquote><p>We want to provide the user with two SMS commands to manage their subscription status: <code>subscribe</code> and <code>unsubscribe</code>.  These commands will toggle a boolean flag for their <code>Subscriber</code> record in the database, and will determine whether or not they receive messages from our marketing campaign. Because we&#39;re not jerks, we don&#39;t opt them in automatically - rather, we have them confirm that they want to receive messages from us first.</p>
<p>To make this happen, we will need to update the controller logic which handles the incoming text message to do a couple things:</p>
<ul>
<li>If the texter is a person already in the database, parse the message they sent to see if it&#39;s a command we recognize</li>
<li>If it is a <code>subscribe</code> or <code>unsubscribe</code> command, update their subscription status in the database</li>
<li>If it is a command we don&#39;t recognize, send them a message explaining available commands</li>
</ul>
<p>Let&#39;s go back into our controller function to see how this works.</p>
</div><div data-title="Processing an Incoming Message" data-file="MarketingNotifications/Controllers/NotificationsController.cs" data-highlight="82-104" class="step"><h2 id="processing-an-incoming-message">Processing an Incoming Message</h2>
<p>This private method handles parsing the incoming message from the user and executing conditional logic to see if they have issued us a command we recognize. It&#39;s executed after we have already hit the database once to retrieve the current <code>Subscriber</code> model.</p>
</div><div data-title="Handling a Subscription Command" data-file="MarketingNotifications/Controllers/NotificationsController.cs" data-highlight="86-97" class="step"><h2 id="handling-a-subscription-command">Handling a Subscription Command</h2>
<p>If the user has texted <code>subscribe</code> or <code>stahp</code>, we will update their subscription status in the database. We will then respond to them via SMS with the opposite command to either opt in to updates or opt out.</p>
</div><div data-title="Listing Available Commands" data-file="MarketingNotifications/Controllers/NotificationsController.cs" data-highlight="98-101" class="step"><h2 id="listing-available-commands">Listing Available Commands</h2>
<p>If they texted in something we don&#39;t recognize, we respond to them with a listing of all known commands. We could take this further and implement &quot;help&quot; text for each command, but in this simple use case the commands should be self-explanatory.</p>
</div><div data-title="Responding with TwiML" data-file="MarketingNotifications/Controllers/NotificationsController.cs" data-highlight="106-111" class="step"><h2 id="responding-with-twiml">Responding with TwiML</h2>
<p>The Twilio .NET library includes a subclass of <code>ActionResult</code> called <code>TwiMLResult</code> that can be returned from our <code>NotificationsController</code> since it subclasses <code>TwilioController</code>. This makes it easy to generate a TwiML response to return from our <code>/Incoming</code> method. We create a <code>GenerateTwiML</code> method our controller can call to close out the interaction with our incoming message.</p>
<p>That&#39;s it for the user-facing commands! Now, we need to provide our marketing team with an interface to send messages out to all subscribers. Let&#39;s take a look at that next.</p>
</div></div>
<div class="saurus-files" style="display:none;"><textarea class="saurus-file" data-file="MarketingNotifications/Models/Subscriber.cs" data-mode="csharp">77u/dXNpbmcgU3lzdGVtOwp1c2luZyBTeXN0ZW0uQ29sbGVjdGlvbnMuR2VuZXJpYzsKdXNpbmcgU3lzdGVtLkNvbmZpZ3VyYXRpb247CnVzaW5nIFN5c3RlbS5EYXRhLkVudGl0eTsKdXNpbmcgU3lzdGVtLkxpbnE7CnVzaW5nIFN5c3RlbS5UZXh0Owp1c2luZyBTeXN0ZW0uVGhyZWFkaW5nLlRhc2tzOwp1c2luZyBUd2lsaW87CgpuYW1lc3BhY2UgTWFya2V0aW5nTm90aWZpY2F0aW9ucy5Nb2RlbHMKewogICAgcHVibGljIGNsYXNzIFN1YnNjcmliZXIKICAgIHsKICAgICAgICBwdWJsaWMgaW50IElkIHsgZ2V0OyBzZXQ7IH0KICAgICAgICBwdWJsaWMgc3RyaW5nIFBob25lTnVtYmVyIHsgZ2V0OyBzZXQ7IH0KICAgICAgICBwdWJsaWMgYm9vbCBTdWJzY3JpYmVkIHsgZ2V0OyBzZXQ7IH0KCiAgICAgICAgcHVibGljIHZvaWQgU2VuZE1lc3NhZ2Uoc3RyaW5nIG1lc3NhZ2UsIHN0cmluZyBpbWFnZVVybCkKICAgICAgICB7CiAgICAgICAgICAgIHZhciB0d2lsaW9OdW1iZXIgPSBDb25maWd1cmF0aW9uTWFuYWdlci5BcHBTZXR0aW5nc1siVHdpbGlvUGhvbmVOdW1iZXIiXTsKICAgICAgICAgICAgdmFyIGNsaWVudCA9IG5ldyBUd2lsaW9SZXN0Q2xpZW50KAogICAgICAgICAgICAgICAgQ29uZmlndXJhdGlvbk1hbmFnZXIuQXBwU2V0dGluZ3NbIlR3aWxpb0FjY291bnRTaWQiXSwKICAgICAgICAgICAgICAgIENvbmZpZ3VyYXRpb25NYW5hZ2VyLkFwcFNldHRpbmdzWyJUd2lsaW9BdXRoVG9rZW4iXQogICAgICAgICAgICApOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgIGlmKGltYWdlVXJsICE9ICIiKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBjbGllbnQuU2VuZE1lc3NhZ2UodHdpbGlvTnVtYmVyLCB0aGlzLlBob25lTnVtYmVyLCBtZXNzYWdlLCBuZXcgc3RyaW5nW10geyBpbWFnZVVybCB9KTsgICAgCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBjbGllbnQuU2VuZE1lc3NhZ2UodHdpbGlvTnVtYmVyLCB0aGlzLlBob25lTnVtYmVyLCBtZXNzYWdlKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAgCiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBpbnRlcmZhY2UgSVN1YnNjcmliZXJDb250ZXh0CiAgICB7CiAgICAgICAgRGJTZXQ8U3Vic2NyaWJlcj4gU3Vic2NyaWJlcnMgeyBnZXQ7ICB9CiAgICAgICAgaW50IFNhdmVDaGFuZ2VzKCk7CiAgICB9CgogICAgcHVibGljIGNsYXNzIFN1YnNjcmliZXJDb250ZXh0IDogRGJDb250ZXh0LCBJU3Vic2NyaWJlckNvbnRleHQKICAgIHsKICAgICAgICBwdWJsaWMgRGJTZXQ8U3Vic2NyaWJlcj4gU3Vic2NyaWJlcnMgeyBnZXQ7IHNldDsgfQogICAgfQoKICAgIHB1YmxpYyBjbGFzcyBUZXN0U3Vic2NyaWJlckNvbnRleHQgOiBJU3Vic2NyaWJlckNvbnRleHQKICAgIHsKICAgICAgICBwdWJsaWMgRGJTZXQ8U3Vic2NyaWJlcj4gU3Vic2NyaWJlcnMgeyBnZXQ7IHNldDsgfQoKICAgICAgICBwdWJsaWMgVGVzdFN1YnNjcmliZXJDb250ZXh0KCkKICAgICAgICB7CiAgICAgICAgICAgIHRoaXMuU3Vic2NyaWJlcnMgPSBuZXcgVGVzdERiU2V0PFN1YnNjcmliZXI+KCk7CiAgICAgICAgfQogICAgICAgIHB1YmxpYyBpbnQgU2F2ZUNoYW5nZXNDb3VudCB7IGdldDsgcHJpdmF0ZSBzZXQ7IH0KICAgICAgICBwdWJsaWMgaW50IFNhdmVDaGFuZ2VzKCkKICAgICAgICB7CiAgICAgICAgICAgIHRoaXMuU2F2ZUNoYW5nZXNDb3VudCsrOwogICAgICAgICAgICByZXR1cm4gMTsKICAgICAgICB9IAogICAgfQp9Cg==</textarea>
<textarea class="saurus-file" data-file="MarketingNotifications/App_Start/RouteConfig.cs" data-mode="csharp">77u/dXNpbmcgU3lzdGVtOwp1c2luZyBTeXN0ZW0uQ29sbGVjdGlvbnMuR2VuZXJpYzsKdXNpbmcgU3lzdGVtLkxpbnE7CnVzaW5nIFN5c3RlbS5XZWI7CnVzaW5nIFN5c3RlbS5XZWIuTXZjOwp1c2luZyBTeXN0ZW0uV2ViLlJvdXRpbmc7CgpuYW1lc3BhY2UgTWFya2V0aW5nTm90aWZpY2F0aW9ucwp7CiAgICBwdWJsaWMgY2xhc3MgUm91dGVDb25maWcKICAgIHsKICAgICAgICBwdWJsaWMgc3RhdGljIHZvaWQgUmVnaXN0ZXJSb3V0ZXMoUm91dGVDb2xsZWN0aW9uIHJvdXRlcykKICAgICAgICB7CiAgICAgICAgICAgIHJvdXRlcy5JZ25vcmVSb3V0ZSgie3Jlc291cmNlfS5heGQveypwYXRoSW5mb30iKTsNCg0KICAgICAgICAgICAgcm91dGVzLk1hcFJvdXRlKA0KICAgICAgICAgICAgICAgIG5hbWU6ICJNZXNzYWdlcyIsDQogICAgICAgICAgICAgICAgdXJsOiAibWVzc2FnZSIsDQogICAgICAgICAgICAgICAgZGVmYXVsdHM6IG5ldyB7IGNvbnRyb2xsZXIgPSAiTm90aWZpY2F0aW9ucyIsIGFjdGlvbiA9ICJJbmNvbWluZyIgfQ0KICAgICAgICAgICAgKTsKCiAgICAgICAgICAgIHJvdXRlcy5NYXBSb3V0ZSgKICAgICAgICAgICAgICAgIG5hbWU6ICJEZWZhdWx0IiwKICAgICAgICAgICAgICAgIHVybDogIntjb250cm9sbGVyfS97YWN0aW9ufS97aWR9IiwKICAgICAgICAgICAgICAgIGRlZmF1bHRzOiBuZXcgeyBjb250cm9sbGVyID0gIk5vdGlmaWNhdGlvbnMiLCBhY3Rpb24gPSAiSW5kZXgiLCBpZCA9IFVybFBhcmFtZXRlci5PcHRpb25hbCB9CiAgICAgICAgICAgICk7CiAgICAgICAgfQogICAgfQp9Cg==</textarea>
<textarea class="saurus-file" data-file="MarketingNotifications/Controllers/NotificationsController.cs" data-mode="csharp">77u/dXNpbmcgU3lzdGVtOwp1c2luZyBTeXN0ZW0uQ29sbGVjdGlvbnMuR2VuZXJpYzsKdXNpbmcgU3lzdGVtLkxpbnE7CnVzaW5nIFN5c3RlbS5XZWI7CnVzaW5nIFN5c3RlbS5XZWIuTXZjOwp1c2luZyBUd2lsaW87CnVzaW5nIFR3aWxpby5Ud2lNTDsKdXNpbmcgVHdpbGlvLlR3aU1MLk12YzsKdXNpbmcgTWFya2V0aW5nTm90aWZpY2F0aW9ucy5Nb2RlbHM7CnVzaW5nIFN5c3RlbS5UaHJlYWRpbmcuVGFza3M7CnVzaW5nIE1hcmtldGluZ05vdGlmaWNhdGlvbnMuSGVscGVyczsKCm5hbWVzcGFjZSBNYXJrZXRpbmdOb3RpZmljYXRpb25zLkNvbnRyb2xsZXJzCnsKICAgIHB1YmxpYyBjbGFzcyBOb3RpZmljYXRpb25zQ29udHJvbGxlciA6IFR3aWxpb0NvbnRyb2xsZXIKICAgIHsKICAgICAgICBJU3Vic2NyaWJlckNvbnRleHQgX2RiOwogICAgICAgIHB1YmxpYyBOb3RpZmljYXRpb25zQ29udHJvbGxlcigpCiAgICAgICAgewogICAgICAgICAgICBfZGIgPSBuZXcgU3Vic2NyaWJlckNvbnRleHQoKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBOb3RpZmljYXRpb25zQ29udHJvbGxlcihJU3Vic2NyaWJlckNvbnRleHQgZGIpCiAgICAgICAgewogICAgICAgICAgICBfZGIgPSBkYjsKICAgICAgICB9CgogICAgICAgIC8vIEdFVDogTm90aWZpY2F0aW9ucwogICAgICAgIFtIdHRwR2V0XQogICAgICAgIHB1YmxpYyBBY3Rpb25SZXN1bHQgSW5kZXgoKQogICAgICAgIHsKICAgICAgICAgICAgcmV0dXJuIFZpZXcoKTsKICAgICAgICB9CgogICAgICAgIC8vIFBPU1Q6IE5vdGlmaWNhdGlvbnMKICAgICAgICBbSHR0cFBvc3RdCiAgICAgICAgcHVibGljIEFjdGlvblJlc3VsdCBJbmRleChzdHJpbmcgbWVzc2FnZSwgc3RyaW5nIGltYWdlVXJsKQogICAgICAgIHsKICAgICAgICAgICAgdHJ5CiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGZvcmVhY2ggKHZhciBzdWJzY3JpYmVyIGluIF9kYi5TdWJzY3JpYmVycy5XaGVyZShzID0+IHMuU3Vic2NyaWJlZCkpCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgc3Vic2NyaWJlci5TZW5kTWVzc2FnZShtZXNzYWdlLCBpbWFnZVVybCk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgU3VjY2Vzc0FsZXJ0KCJNZXNzYWdlcyBhcmUgb24gdGhlaXIgd2F5ISIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhdGNoCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIEVycm9yQWxlcnQoIlNvbWV0aGluZyB3ZW50IHdyb25nLiBUcnkgYWdhaW4uIik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIHJldHVybiBWaWV3KCk7CiAgICAgICAgfQoKICAgICAgICAvLyBQT1NUOiBJbmNvbWluZwogICAgICAgIFtIdHRwUG9zdF0KICAgICAgICBwdWJsaWMgVHdpTUxSZXN1bHQgSW5jb21pbmcoc3RyaW5nIGZyb20sIHN0cmluZyBib2R5KQogICAgICAgIHsKICAgICAgICAgICAgc3RyaW5nIHJlc3BvbnNlOwogICAgICAgICAgICBTdWJzY3JpYmVyIHN1YnNjcmliZXIgPSBfZGIuU3Vic2NyaWJlcnMuRmlyc3RPckRlZmF1bHQocyA9PiBzLlBob25lTnVtYmVyID09IGZyb20pOwoKICAgICAgICAgICAgaWYgKHN1YnNjcmliZXIgPT0gbnVsbCkKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgLy8gSWYgc3Vic2NyaWJlciBub3QgZm91bmQsIGNyZWF0ZSBuZXcgc3Vic2NyaWJlciBhbmQgcmV0dXJuIHNpZ251cCBwcm9tcHQuCiAgICAgICAgICAgICAgICBzdWJzY3JpYmVyID0gX2RiLlN1YnNjcmliZXJzLkFkZChuZXcgU3Vic2NyaWJlciB7IFBob25lTnVtYmVyID0gZnJvbSB9KTsKICAgICAgICAgICAgICAgIHJlc3BvbnNlID0gIlRoYW5rcyBmb3IgY29udGFjdGluZyB1cyEgVGV4dCAnc3Vic2NyaWJlJyBpZiB5b3Ugd291bGQgbGlrZSB0byByZWNlaXZlIHVwZGF0ZXMgdmlhIHRleHQgbWVzc2FnZS4iOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgLy8gT3RoZXJ3aXNlLCBwcm9jZXNzIHRoZSBtZXNzYWdlIGZvciBleGlzdGluZyBzdWJzY3JpYmVyLgogICAgICAgICAgICAgICAgcmVzcG9uc2UgPSBQcm9jZXNzTWVzc2FnZShib2R5LlRvTG93ZXIoKSwgc3Vic2NyaWJlcik7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIFNhdmUgYW55IGNoYW5nZXMgbWFkZSB0byB0aGUgU3Vic2NyaWJlciB0byB0aGUgZGF0YWJhc2UKICAgICAgICAgICAgX2RiLlNhdmVDaGFuZ2VzKCk7CgogICAgICAgICAgICAvLyBHZW5lcmF0ZSBhbmQgcmV0dXJuIFR3aU1MIHJlc3BvbnNlCiAgICAgICAgICAgIHJldHVybiBHZW5lcmF0ZVR3aU1MKHJlc3BvbnNlKTsKICAgICAgICB9CgogICAgICAgIHByaXZhdGUgc3RyaW5nIFByb2Nlc3NNZXNzYWdlKHN0cmluZyBtZXNzYWdlLCBTdWJzY3JpYmVyIHN1YnNjcmliZXIpCiAgICAgICAgewogICAgICAgICAgICBzdHJpbmcgb3V0cHV0OwoKICAgICAgICAgICAgaWYgKG1lc3NhZ2UgPT0gInN1YnNjcmliZSIgfHwgbWVzc2FnZSA9PSAic3RhaHAiKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBzdWJzY3JpYmVyLlN1YnNjcmliZWQgPSBtZXNzYWdlID09ICJzdWJzY3JpYmUiOwogICAgICAgICAgICAgICAgaWYgKHN1YnNjcmliZXIuU3Vic2NyaWJlZCkKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBvdXRwdXQgPSAiWW91IGFyZSBub3cgc3Vic2NyaWJlZCBmb3IgdXBkYXRlcy4gVGV4dCAnc3RhaHAnIGF0IGFueSB0aW1lIHRvIHN0b3AgcmVjZWl2aW5nIHVwZGF0ZXMuIjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBvdXRwdXQgPSAiWW91IGhhdmUgdW5zdWJzY3JpYmVkIGZyb20gbm90aWZpY2F0aW9ucy4gVGV4dCAnc3Vic2NyaWJlJyB0byBzdGFydCByZWNlaXZpbmcgdXBkYXRlcyBhZ2Fpbi4iOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgb3V0cHV0ID0gIlNvcnJ5LCB3ZSBkb24ndCByZWNvZ25pemUgdGhhdCBjb21tYW5kLiBBdmFpbGFibGUgY29tbWFuZHMgYXJlOiAnc3Vic2NyaWJlJyBvciAnc3RhaHAnLiI7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiBvdXRwdXQ7CiAgICAgICAgfQoKICAgICAgICBwcml2YXRlIFR3aU1MUmVzdWx0IEdlbmVyYXRlVHdpTUwoc3RyaW5nIG1lc3NhZ2UpCiAgICAgICAgewogICAgICAgICAgICB2YXIgcmVzcG9uc2UgPSBuZXcgVHdpbGlvUmVzcG9uc2UoKTsKICAgICAgICAgICAgcmVzcG9uc2UuTWVzc2FnZShtZXNzYWdlKTsKICAgICAgICAgICAgcmV0dXJuIFR3aU1MKHJlc3BvbnNlKTsKICAgICAgICB9CgogICAgICAgICNyZWdpb24gQWxlcnRzCiAgICAgICAgcHJpdmF0ZSB2b2lkIEFkZEFsZXJ0KHN0cmluZyBhbGVydFN0eWxlLCBzdHJpbmcgbWVzc2FnZSwgYm9vbCBkaXNtaXNzYWJsZSkKICAgICAgICB7CiAgICAgICAgICAgIHZhciBhbGVydHMgPSBUZW1wRGF0YS5Db250YWluc0tleShBbGVydC5UZW1wRGF0YUtleSkKICAgICAgICAgICAgICAgID8gKExpc3Q8QWxlcnQ+KVRlbXBEYXRhW0FsZXJ0LlRlbXBEYXRhS2V5XQogICAgICAgICAgICAgICAgOiBuZXcgTGlzdDxBbGVydD4oKTsKICAgICAgICAgICAgYWxlcnRzLkFkZChuZXcgQWxlcnQKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgQWxlcnRTdHlsZSA9IGFsZXJ0U3R5bGUsCiAgICAgICAgICAgICAgICBNZXNzYWdlID0gbWVzc2FnZSwKICAgICAgICAgICAgICAgIERpc21pc3NhYmxlID0gZGlzbWlzc2FibGUKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBUZW1wRGF0YVtBbGVydC5UZW1wRGF0YUtleV0gPSBhbGVydHM7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgdm9pZCBTdWNjZXNzQWxlcnQoc3RyaW5nIG1lc3NhZ2UsIGJvb2wgZGlzbWlzc2FibGUgPSBmYWxzZSkKICAgICAgICB7CiAgICAgICAgICAgIEFkZEFsZXJ0KEFsZXJ0U3R5bGVzLlN1Y2Nlc3MsIG1lc3NhZ2UsIGRpc21pc3NhYmxlKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyB2b2lkIEVycm9yQWxlcnQoc3RyaW5nIG1lc3NhZ2UsIGJvb2wgZGlzbWlzc2FibGUgPSBmYWxzZSkKICAgICAgICB7CiAgICAgICAgICAgIEFkZEFsZXJ0KEFsZXJ0U3R5bGVzLkRhbmdlciwgbWVzc2FnZSwgZGlzbWlzc2FibGUpOwogICAgICAgIH0KICAgICAgICAjZW5kcmVnaW9uCiAgICB9Cn0=</textarea>
</div>
</div><div class="saurus-overview"><ul></ul></div></div><div class="saurus-code"><div class="file-path"><span class="crumb-container"></span><i class="fa fa-fw fa-folder"></i></div><div class="saurus-editor"></div></div><div class="saurus-explorer"><div class="saurus-file-list"></div></div></div></div></div><script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script><script src="//cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js"></script><script src="//cdnjs.cloudflare.com/ajax/libs/backbone.js/1.1.2/backbone-min.js"></script><script src="ace/ace.js"></script><script src="ace/theme-monokai.js"></script><script src="viewsaurus.js"></script></body></html>